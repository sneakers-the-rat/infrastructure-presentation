import { Dataset } from '../components/dataset'
import { Peer } from '../components/peer'
import Swarm from '../components/swarm'
import { Heading, Box, Text, Image, Grid, Quote, Appear } from 'spectacle'
import Paper from '@material-ui/core/Paper'
import PirateBay from '../img/piratebay.png'
import Federation from '../img/federation-overview.png'
import Card from '@material-ui/core/Card';
import CardContent from '@material-ui/core/CardContent';
import Button from '@material-ui/core/Button';
import Typography from '@material-ui/core/Typography';
import VerticalLinearStepper from '../components/vertical_stepper'

import funky from 'react-syntax-highlighter/dist/cjs/styles/prism/funky'

# Shared Data

(title slide)

Notes: notes!
* simplifying standardization
* peer to peer systems
* federated databases

---


<Heading marginLeft={'0px'} textAlign={'left'}>
  Decentralized Data
</Heading>
<Text fontSize={30} fontFamily={'monospace'} style={{ marginBottom: '12px' }}>
  To start, we need our data to be...
</Text>
<Box width={4 / 9}>
  <VerticalLinearStepper
      steps={[
        {
          title: 'Interoperable',
          body: 'Usable across experimental, analytical, and storage tools',
        },
        {
          title: 'Annotated',
          body:
              'Self-documented, requiring no additional information to understand',
        },
        {
          title: 'Portable',
          body:
              'All the pieces of a dataset are contained within! No "external files" loose\
          in our data directory. Large data like video, high-density electrophysiology \
          are supported by native, domain-specific compression.',
        },
        {
          title: 'Streamable',
          body:
              "Relatedly, the sub-pieces of a dataset need to be separable such that \
          someone doesn't need to download your massive exabyte dataset just to look \
          at the date it was collected",
        },
        {
          title: 'Discoverable',
          body:
              "Two kinds: findable by people who know what they're looking for (and what \
          they're looking for is your data, of course!), ie. searchable, and also as part \
          of a structured knowledge repository among other data of its type. More on this \
          in the federated p2p section...",
        },
      ]}
  />
  <Appear>
    <Paper
        style={{ backgroundColor: '#F5F5F5', marginTop: '24px', padding: '12px' }}
    >
      <Text
          fontSize={30}
          fontFamily={'monospace'}
          textAlign={'center'}
          marginTop={'1em'}
      >
        In other words, we need some kind of
      </Text>
      <Heading>~standardized format~</Heading>
      <Text fontSize={20} fontFamily={'monospace'} textAlign={'center'}>
        (who me? oh no who left all my data all over the floor)
      </Text>
    </Paper>
  </Appear>
</Box>

<svg width={1920} height={1080} className={'svg-fill'}>
  <Dataset
      name="data.exe"
      cols={[
        { name: 'apple', size: 3 },
        { name: 'banana', size: 5 },
        { name: 'peanut', size: 6 },
        { name: 'walrus', size: 2 },
        { name: 'fear', size: 4 },
      ]}
      position={[1750, 200]}
      orientation={90}
      scatter={{
        x: { scale: 30, lambda: 0.2, offset: 0 },
        y: { scale: 50, lambda: 0.5, offset: 50 },
        rotate: true,
      }}
      scale={2}
      outlines={true}
  />
</svg>

---

# NWB

NWB, A spec & some tools!

(figure of spec)

---

<Heading>Make It Easy!</Heading>
<Box width={2/3} marginLeft={'auto'} marginRight={'auto'}>
  <Text fontSize={30} fontFamily={'monospace'} style={{marginBottom:"12px"}} textAlign={"center"}>
    Standardizing data is *hard* and there are very few professional incentives to do it.
    Rather than just getting *mad* at people and *bullying* them into open science,
    it needs to be *easy*</Text>
  <Text fontSize={30} fontFamily={'monospace'} style={{marginBottom:"12px"}} textAlign={"center"}>
    Here's my take:
  </Text>

  ** Omitted bc no code walkthroughs 2day**

  <Link fontSize={20} href={"https://onice-conversion.readthedocs.org"} textAlign={"center"} fontFamily={'monospace'}>Docs at https://onice-conversion.readthedocs.org</Link>

</Box>

<Box width={2/3} marginLeft={'auto'} marginRight={'auto'}>
  <Text fontSize={20} fontFamily={'monospace'} style={{marginBottom:"12px"}} textAlign={"center"}>
    And ya and also rewarding, what do people get out of their labor? we'll get there.</Text>

</Box>



---
# How to share?

Once we've got our data standardized, now what?

Now, we would find some centralized server to upload to...

---

<Heading marginLeft={'0px'} textAlign={'left'}>P2P</Heading>

<Box width={3/7}>
<Text fontFamily={'monospace'} style={{marginBottom:"4em"}} fontSize={"32px"}>
  What i will tell u now u will never believe
</Text>
  <Text fontFamily={'monospace'} fontWeight={'bold'} style={{marginBottom:"3em", color: "#ff0000", filter: "drop-shadow(30px 30px 0px #CCCCCC"}}>
  in a p2p system, everyone is the server.
</Text>
  <Text fontFamily={'monospace'}>
    this is why pirates curate the largest cultural archives
    that have ever existed
  </Text>
  <Text fontFamily={'monospace'} fontSize={"32px"}>
  (pick your metric: completeness, availability,
  size, community involvement, bandwidth usage, ...)
  </Text>
</Box>

<svg width={1920} height={1080} className={'svg-fill'} id={"svg-root"}>
  <Swarm
      position={[1400,500]}
      radius={350}
      name={'swarm'}
      peers={{
        scale: 2,
        names: ['jonny', 'rumbly', 'santi','tito','timothy', 'apple', 'banana', 'kiwi', 'watermelon', 'macarena'],
        datasets:{
          n_range: [2,5],
          col_range:[3,6],
          size_range:[2,6],
          scale:0.01
        }}}
  />
</svg>

---

# Comparison

comparison of server architecture and p2p quantitatively.

Notes: popup with more info

That p2p system is literally the most basic one. extend it in a bunch of ways

* Versioning
* Obligate Peers - making it always at least as fast as

---

# problems with p2p systems

* ppl freaking drop out!
* rare material can get lost if only one peer has it!
* make networks sad! (this one is just a QoS one so we can ignore that)

but what if i told u that there have been hundreds of thousands of people experimenting
with the culture of how to make a peer-to-peer data archival system
sustainable for decades? and those ppl are pirates?

We get one early lesson from the pirates, and thats to divide the
*database* itself from the *means of accessing it*


---

# Interdependent Frontends Are Cool, But...

We're familiar with extremely sick, domain-specific databases like this one from the IBL:

<Box width={"80%"} height={"80%"} margin={"auto"}>
<Paper elevation={1} style={{width:"100%", height:"100%"}}>
<iframe width={"100%"} height={"100%"}
        src={"https://data.internationalbrainlab.org/mouse/00778394-c956-408d-8a6c-ca3b05a611d5"}
  />
</Paper>
</Box>

---

# Databases Are Political

If we pay attention to the people who study these things...

<Box width={2/3} marginLeft={"auto"} marginRight={"auto"}>
  <Card elevation={1}>
    <CardContent>
      <Quote fontSize={36}>
        Participants describe the individual sequence database
        systems as if they were shadows, poor representations of a
        widely-agreed-upon ideal. [...] Instead, <strong>each decision about the implementation of a particular
        database system plants a stake for a community boundary.</strong>
        The databases are not so much imperfect copies of an ideal as
        they are arguments about what the ideal Database should be.
        <br/><br/>
        In the end, however, the system was so tailored to a specific
        set of research questions that the collection of data,
        the set of tools, and even the social organization of the
        project had to be significantly changed. ...
        <br/><br/>While the database development projects had begun by working
        together, in the end they were unable to collaborate. <strong>The system
        that was supposed to tie these groups together could not be
        shielded from the controversies that formed the boundaries between
        the communities of practice.</strong>
      </Quote>
      <Text fontSize={30}>-Bietz & Lee (2009)
        <Link fontSize={30} href={"https://doi.org/10.1007/978-1-84882-854-4_15"}>
          "Collaboration in Metagenomics"</Link></Text>
    </CardContent>
  </Card>
</Box>


---

# Lessons from piracy...

<Grid gridTemplateColumns={"2fr 1fr"} height={"100%"}>
<Box width={"100%"}>
  <Text>You need some way of finding torrents!</Text>
  <Text>So there are these trackers, u might be familiar with this 1</Text>
  <br/><br/>
  <Appear stepIndex={2}>
  <Heading fontSize={'h2'}>Enter Private Trackers:</Heading>
  <Text marginTop={'26px'}>Interview in or invite-only, each tracker has its own culture, rules,
    history, and specific tools that facilitate it.</Text>
  <br/><br/>
  <Text>Separating the interface from the protocol made space for what is now a
  decadeslong experiment in decentralized archivalism</Text>
  <Text fontSize={26} fontStyle={"italic"}>(we will return to them later!)</Text></Appear>
</Box>
<Appear stepIndex={1}><Image src={PirateBay} maxWidth={"100%"} alignSelf={"center"} /></Appear>
</Grid>

<Appear stepIndex={3}>
  <Card style={{marginBottom:"auto"}} elevation={1}>
<Heading fontSize={"h2"}>Problem tho:</Heading>
    <Text style={{padding:"1em"}}>If we have a bunch of different sites, how is that any better than having a zillion centralized databases?</Text></Card></Appear>

---

# Federated systems

<Grid gridTemplateColumns={"1fr 1fr"} height={"100%"}>
  <Card>
    <Typography>basic idea here is that we</Typography>
    <Text>a) conceptualize our data storage system as a *sharing* system first</Text>
    <Text>b) choose the other *users* and *servers* we want to federate with</Text>
    <Text>c) federations operate on a common protocol that allows communication between instances</Text>
    <Text>d) but each user/instance/etc. retains <strong>design autonomy</strong> -- share the *data* not the design</Text>
  </Card>

<Image src={Federation}/>
</Grid>

---

# Eg. "The Fediverse"

Built on W3C's "ActivityPub" protocol, an interconnected network of autonomous social media networks


<Box width={"80%"} height={"80%"} margin={"auto"}>
  <Paper elevation={1} style={{width:"100%", height:"100%"}}>
    <iframe width={"100%"} height={"100%"} loading={"lazy"}
            src={"https://kumu.io/wakest/fediverse"}
    />
  </Paper>
</Box>


---

# Federated database systems



---

---

# General needs for scientific federated db system

* versioning
* privacy/sharing control


could be
* IPFS
* Hypercore

---


