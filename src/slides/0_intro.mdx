import {Heading, Text, Quote, Appear, Link, Grid, Box, FlexBox, SlideContext} from 'spectacle'
import Paper from '@material-ui/core/Paper'
import Card from '@material-ui/core/Card';
import CardContent from '@material-ui/core/CardContent';
import Typography from '@material-ui/core/Typography';
import VerticalLinearStepper from '../components/vertical_stepper'
import SvgAnimator from '../components/svg_animator';
import Plax from '../img/plax_3_closed_loop.svg'
import TitleCard from '../img/cover.svg'
import Overview from '../img/overview.svg'
import anime from 'animejs'
import BasicCard, { PositionedCard } from '../components/basiccard';
import {distance} from '../components/utils';
import Stepper from '../components/stepper';
import {PositionedHeading, Collapser} from '../components/basic';
import TextAnimator from '../components/text/TextAnimator';
import ChatAnimator from '../components/text/ChatAnimator';
import UsaAvatar from '../img/usaAvatar.png'
import AmazonLogo from '../img/amazonlogo.png'

<Heading
  fontFamily={'titleHeader'}
  fontSize={'100pt'}
  textAlign={'left'}
  lineHeight={1.0}
  fontWeight={'bold'}
>
  Decentralized Infrastructure for Systems Neuroscience
</Heading>

<Paper elevation={3}>
  <Text>  Jonny Saunders, 2021</Text>
</Paper>


Notes: presenter notes??
  - put a big animated version of The System here why dontcha
  - try ramda!!! https://github.com/ramda/ramda/wiki/Cookbook
  - https://github.com/chenglou/react-motion
  - for simple animations https://reactjs.org/docs/animation.html
  - stepping through text: https://codesandbox.io/s/framer-motion-split-text-o1r7d?from-embed
    - https://github.com/framer/motion
    - https://popmotion.io/pose/api/react-pose-text/
toc:
  - use any of these props https://github.com/FormidableLabs/spectacle/blob/75052e61bedabf5ed9965506bb1fb7e82112782f/src/components/deck/deck.js#L349
  - see https://github.com/FormidableLabs/spectacle/blob/75052e61bedabf5ed9965506bb1fb7e82112782f/src/components/progress.js#L25

other softwarez to mention:
  - dataverse
  - datalad
  - DANDI


---
<SvgAnimator
    svgUrl={TitleCard}
    steps={[
      [
        {
          targets: '#computers-1 '+'#Layer_2 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(1000, 2000),
          delay: anime.random(0, 200),
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-heading',
          opacity: [0, 1],
          duration: 500,
          easing: 'easeOutQuart'
        }
      ],
      [
        {
          targets: '#computers-1 '+'#Layer_5 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1185, y:715})*3;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-1 '+'#Layer_4 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(250, 500),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1185, y:715})*2;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },{
        targets: '#computers-1 '+'.cls-4',
        strokeDashoffset: [anime.setDashoffset, 0],
        duration: anime.random(3000, 5000),
        direction: 'alternate',
        delay: anime.random(0, 1000),
        easing: 'easeInOutCirc',
        loop: true
      },
        {
          targets: '#experiment-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }],
      [
        {
          targets: '#computers-1 '+'#Layer_6 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1306, y:716})*5;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#computers-1 '+'.cls-5',
          strokeDashoffset: [anime.setDashoffset, 0],
          strokeDasharray: [100, anime.setDashoffset],
          duration: anime.random(3000, 8000),
          direction: 'alternate',
          delay: function(el, i) {
            return Math.random() * 5000
          },
          easing: 'linear',
          loop: true
        },
        {
          targets: '#data-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }],
      [
        {
          targets: '#computers-1 '+'#Layer_3 *',
          strokeDashoffset: [anime.setDashoffset, 0],
          duration: anime.random(500, 1000),
          delay: function(el){
            let dist = distance(el.getBBox(), {x:1257, y:308})*3;
            console.log('dist', dist);
            return dist;
          },
          easing: 'easeInOutCirc',
          loop: false
        },
        {
          targets: '#share-card',
          opacity: [0, 1],
          duration: 1000,
          delay:1000,
          easing: 'easeOutQuint'
        }
        ],
    [
      {targets:'#computers-smiley-0',
        easing:'easeOutBounce',
      opacity:[0,1],
      scale:[0,1]}
    ],
    [
      {targets:'#computers-smiley-1',
      easing:'easeOutBounce',
        opacity:[0,1],
        scale:[0,1]}
    ],
    [
      {targets:'#computers-smiley-2',
      easing:'easeOutBounce',
        opacity:[0,1],
        scale:[0,1]}
    ]]}
    id={'computers-1'}
/>


<Box width={1/4}
     style={{position:'absolute',
       left:'30px'}}>
  <Heading
    fontFamily={'monospace'}
    fontWeight={'lighter'}
    lineHeight={1.1}
    backgroundColor={"#333333"}
    color={"#ffffff"}
    fontSize={"6em"}
  textAlign={'right'}
  id={"computers-heading"}
  width={1/3}
>What<br/>computer<br/>do?</Heading>
<Grid gridTemplateColumns={"1fr 1fr 1fr"}>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-0" fontFamily={'monospace'}>:\</Text>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-1" fontFamily={'monospace'}>:(</Text>
  <Text fontSize={50} textAlign={'center'} id="computers-smiley-2" fontFamily={'monospace'}>:'(</Text>
</Grid></Box>


<PositionedCard
    id={'experiment-card'} x={40} y={550} width={1/3}
  title={"Control Experiments"}
    body={"Programming experiments is hard! A mÃ©lange of proprietary, open source, and custom-built tools stitched together with in-lab scripts"}
    appearStep={5}
  />

<PositionedCard
    id={'data-card'} x={1300} y={300} width={1/3}
    title={"Store & Analyze Data"}
    body={"Standardization is hard! Mostly stored in ad-hoc formats. Open source tools for basic elements of analysis, but everyone makes their own workflow."}
    appearStep={6}
    />

<PositionedCard
    id={'share-card'} x={600} y={30} width={1/3}
    title={"Share & Communicate"}
    body={"Good sharing practices are hard! 10,000 mutually incompatible centralized databases. PDFs, PPTs, private Slacks, and the godforsaken Science Twitter."}
    appearStep={7}
    />

---

<Box width={2/3}>
  <Collapser>
    <Heading textAlign={'left'} color={"tools"} fontWeight={200} fontStyle={"italic"}>
      (The Absence Of)
    </Heading>
  </Collapser>
  <Heading textAlign={'left'} lineHeight={1}>
    Digital Infrastructure Defines the Everyday Reality of Science
  </Heading>
</Box>

<Grid gridTemplateColumns={'1fr 1fr'} gridGap={"20px"}>
<VerticalLinearStepper
  steps={[
    {
      title: 'Everyone has to be a programmer now',
      body: 'Because generalized infrastructure hasnt been built, researchers need to learn several additional disciplines to do the one they chose. Why does every biologist need to do a masters degrees worth of work on data engineering?',
    },
    {
      title: 'Reinventing most things from scratch',
      body: 'Because we dont have a good way of preserving and sharing technical knowledge, we all resolve the same problem over and over again'
    },
    {
      title: "Most cant afford 'openness'",
      body: 'because it requires so much additional labor, and the professional and personal benefits are so low, many researchers cant afford to use "open" scientific practices --- even if they wanted to.'
    },
    {
      title: 'Scientific discourse at the pleasure of for-profit platforms.',
      body: 'because the mediums of scientific discourse are driven by ad clicks or by deeply entrenched institutional power, we dont have a good medium for sustained, thoughtful, densely interlinked dialogue that takes advantage of the possibilities of contemporary communication technology.'
    }
  ]}
/>
  <VerticalLinearStepper
      steps={[
        {
          title: 'Undone labor of infrastructure falls disproportionately on ECRs',
          body: '',
        },
        {
          title: 'Technical knowledge silos fuel scientific inequity',
          body: ''
        },
        {
          title: "Little means of credit assignment for large numbers of scientific workers",
          body: ''
        },
        {
          title: 'Replication crises, potentially futile to study the brain with such brittle tools',
          body: ''
        }
      ]}
  />
</Grid>

---


<Box width={2 / 3} marginLeft={'auto'} marginRight={'auto'}>

  <Heading fontWeight={200} textAlign={'left'} marginBottom={"2em"}>thought experiment:</Heading>
  <div style={{height: "20px"}}/>
  <Appear>
    <Text>Say we upload all data onto AWS...</Text>
  </Appear>
  <div style={{height: "20px"}}/>
</Box>
<FlexBox justifyContent={'space-evenly'}>
  <Appear height={"100%"}>
    <ChatAnimator
        stepIndex={3}
        isOpen={true}
        agentProfile={{imageUrl: AmazonLogo,
          teamName:"AWS Support"}}
        messages={
          [
            {
              author: 'me',
              type: 'text',
              data: {
                text: 'Sign Up for Science Prime! Subscribe to stream exclusive datasets from elite labs!'
              }
            },
            {
              author: 'me',
              type: 'text',
              data: {
                text: "We're proud to announce a new data sharing agreement with ICE!"
              }
            }
          ]}
    />
  </Appear>
  <Appear height={"100%"}>
    <ChatAnimator
        stepIndex={6}
        isOpen={true}
        agentProfile={{imageUrl: UsaAvatar,
        teamName:"Uncle Sam"}}
        messages={
          [
            {
              author: 'me',
              type: 'text',
              data: {
                text: 'hey amazon, what if you pay taxes?'
              }
            },
            {
              author: 'them',
              type: 'text',
              data: {
                text: 'what if i deleted all scientific knowledge?'
              }
            },
            {
              author: 'them',
              type: 'emoji',
              data: {
                emoji: 'ð'
              }
            }
          ]}
    />
  </Appear>


  <Appear stepIndex={9}>
    <Box width={"400px"}>
      <Card elevation={1}>
        <CardContent>
          <Quote fontSize={36}>Google or some similar
            corporate entity [...]
            will come along with its deep pockets, and
            integrate each segment into one grand proprietary Science 2.0
            platform. <br/><br/><strong>Who would not then want to own the obligatory online
              passage point for the bulk of modern scientific research?</strong>
          </Quote>
          <Text fontSize={30}>-Philip Mirowski (2010)
            <Link fontSize={30} href={"https://doi.org/10.1177/0306312718772086"}>
              "The Future(s) of Open Science"</Link></Text>
        </CardContent>
      </Card>
    </Box>
  </Appear>
</FlexBox>


Notes: v briefly, just making the points that there are lots of ways this could shake out,
say that we'll get to alternatives as we go

---

<SvgAnimator
    svgUrl={Overview}
    steps={[
    [
      {targets:'#rect-data',
      width:[0,750]},
      {targets:"#overview-1 #data *",
        strokeDashoffset: [anime.setDashoffset, 0]
      }
    ],
    [
      {targets:'#rect-tools',
        width:[0,750]},
      {targets:"#overview-1 #tools *",
        strokeDashoffset: [anime.setDashoffset, 0]
      }
    ],
    [
      {targets:'#rect-knowledge',
        width:[0,750]},
      {targets:"#overview-1 #knowledge *",
        strokeDashoffset: [anime.setDashoffset, 0]
      }
    ]
    ]}
    id={'overview-1'}
/>

<PositionedHeading light={false}
                   id={'overview-header'}
                   y={20} right={20}
                   headerProps={{fontWeight:700, fontSize:70}}
align={"right"}>
  A Case For</PositionedHeading>
<PositionedHeading light={false}
                   id={'overview-header'}
                   y={100} right={20} align={"right"}
headerProps={{fontSize:80}}>
  Decentralized<br/>Infrastructure</PositionedHeading>


<PositionedHeading id={'overview-knowledge'} y={250} x={20}>Knowledge</PositionedHeading>

<PositionedHeading id={'overview-tools'} y={600} x={20}>Tools</PositionedHeading>

<PositionedHeading id={'overview-data'} y={950} x={20}>Data</PositionedHeading>

---

# Infrastructuring is hard

huge bodies of knowledge from lots of disciplines re: infrastructure
here we'll focus on

(topic list for each of these?)

* STS
* Library & information science
* Pirates
* Internet architects

## "Let us now anathemize techno hubris"

<Box  width={2/3} margin={"auto"}>
<Card elevation={1}>
  <CardContent>
    <Quote>
      Much technological infrastructure development
      has been motivated by the belief that if we build it they will come. ...<br/><br/>
      <strong>It is not enough to put out a new
      technical infrastructure â it needs to be woven into the daily
        practices of knowledge workers.</strong> <br/><br/> We are dealing with a massively
      entrenched set of institutions, built around the last information age and
      fighting for its life.
    </Quote>
    <Text fontSize={30}>-Bowker et al (2010) <Link fontSize={30} href={"https://doi.org/10.1007/978-1-4020-9789-8_5"}>"Toward Information Infrastructure Studies"</Link></Text>
  </CardContent>
</Card>
</Box>

---

# Why is it like this

(Combine this with previous slide, saying 'if we build it they will come' is one of the reasons. then slim down into 'cultural incentives', 'professional structure, etc.)

the field of infra proposals is littered with the corpses of previous attempts
why did they fail and what can we do differently?

  <Box margin={"auto"} marginTop={"2em"} width={"65%"}>
<VerticalLinearStepper
    steps={[
      {
        title: 'Diversity of measurements & preps',
        body: '',
      },
      {
        title: 'The Hacker Spirit & Celebration of Heroism',
        body: 'Heterogeneity is good! its just the hero part thats the problem!',
      },
      {
        title: 'Focus on The Science At Hand',
        body: 'Scientists dont think of themselves as infrastructuralists, they think of themselves as *scientists*',
      },
      {
        title: 'Combinatorics of Recent Technology',
        body: 'Some of this stuff just started existing!!!',
      },
      {
        title: 'Dispersion of Structural Incentives',
        body: 'next slide... how does infrastructure get done???',
      },
    ]}
/>
  </Box>

---

# Design Principles

<Box margin={"auto"} marginTop={"2em"} width={"65%"}>
<VerticalLinearStepper
    steps={[
      {
        title: "Frameworks, not Platforms",
        body: [
            <Typography>
              Fewer tools, more tools that can build tools
              (so that we can have more tools later)
            </Typography>,
            <Quote fontSize={"1em"} width={"60%"}>A good analogy for the development of the Internet is that of
              constantly renewing the individual streets and buildings of a city,
              rather than razing the city and rebuilding it. The architectural
              principles therefore aim to provide a framework for creating
              cooperation and standards, as a small "spanning set" of rules that
              generates a large, varied and evolving space of technology.
              - <Link href={"https://tools.ietf.org/html/rfc1958"} fontSize={"1em"}>RFC 1958</Link>, Architectural Principles of the Internet
            </Quote>
        ]
      },
      {
        title: 'Embrace Heterogeneity, Be Uncoercive',
        body: "Build protocols and systems that let people integrate their labor in a common framework"+
            " but make as few requirements or restrictions about the particular way they do them as possible."+
            " Give people expressive tools that harness their individual expertise and"+
            " experience rather than constrain it."
      },
      {
        title: 'Empower the End-User',
        body: 'The Internet Protocol was initially designed as a military technology by DARPA,'+
        ' and was constrained by "survivability." Rather than making the *network* powerful,'+
        ' every individual node could sustain the operation of the whole system. We need tools that'+
        ' dont rely on a small group of people to maintain, a central server-farm to pay for, etc.'+
        ' Empowering tools must be *easy and rewarding to use*. Logic or functionality of a system available'+
        ' to only a small number of users breaks the system. If its hard to turn on a faucet, it aint infrastructure.',
      },
      {
        title: 'Modularity is Flexibility',
        body: [
            <Typography>
              Build complex systems out of simple components.
            </Typography>,
            <Typography>
              Let people adopt things gradually
            </Typography>,
          <Typography>
            Reciprocally: "the test of independent invention" -
            if someone else had already invented your system, would theirs work with yours?
            Tools with clear points of interoperability
          </Typography>
        ],
      },
    ]}
/>
</Box>

- https://www.w3.org/DesignIssues/Principles.html
